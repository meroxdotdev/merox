---
import Link from '@/components/Link.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import { NAV_LINKS } from '@/consts'
import { Image } from 'astro:assets'
import logo from '../../public/static/logo.svg'
import logod from '../../public/static/logod.svg'
---

<header
  class="sticky top-0 z-10 transition-all duration-500 md:px-4 md:pt-3"
  transition:persist
  id="main-header"
>
  <div id="header-wrapper" class="transition-all duration-500 md:mt-1 md:mx-auto md:max-w-3xl">
    <div
      id="header-inner"
      class="bg-background/60 border-border/30 flex flex-wrap items-center justify-between gap-4 border px-4 py-3 shadow-lg backdrop-blur-2xl transition-all duration-500 md:rounded-2xl md:border md:shadow-xl md:hover:shadow-2xl relative overflow-hidden"
    >
      <!-- Liquid background effect -->
      <div class="absolute inset-0 bg-gradient-to-br from-background/40 via-transparent to-background/20 pointer-events-none"></div>
      <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-primary/5 via-transparent to-transparent pointer-events-none"></div>
      <div class="absolute -top-1/2 -left-1/2 w-full h-full bg-gradient-conic from-transparent via-primary/10 to-transparent animate-spin-slow pointer-events-none opacity-30"></div>
      <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-primary/20 to-transparent"></div>
      <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-primary/10 to-transparent opacity-50"></div>
      <div class="absolute top-0 left-0 w-px h-full bg-gradient-to-b from-transparent via-primary/15 to-transparent"></div>
      <div class="absolute top-0 right-0 w-px h-full bg-gradient-to-b from-transparent via-primary/15 to-transparent opacity-50"></div>
      <Link
        href="/"
        class="flex shrink-0 items-center gap-3 transition-opacity duration-200 hover:opacity-80"
      >
        <Image src={logo} alt="Logo" class="hidden size-8 dark:block transition-all duration-500" />
        <Image src={logod} alt="Logo" class="block size-8 dark:hidden transition-all duration-500" />
        <span class="site-title">
     <!--     {SITE.title} -->
        </span>
      </Link>
      <div class="flex items-center gap-2 md:gap-4 transition-all duration-500">
        <nav class="hidden items-center gap-4 text-sm sm:gap-6 md:flex transition-all duration-500">
          {NAV_LINKS.map((item) => (
            <Link
              href={item.href}
              class="text-foreground/60 hover:text-foreground relative capitalize transition-colors duration-200 after:absolute after:bottom-0 after:left-0 after:h-[2px] after:w-0 after:bg-current after:transition-all after:duration-200 hover:after:w-full"
            >
              {item.label}
            </Link>
          ))}
        </nav>
        <MobileMenu client:load transition:persist />
        <ThemeToggle transition:persist />
      </div>
    </div>
  </div>

<script>
  if (typeof window !== 'undefined') {
    const wrapper = document.getElementById('header-wrapper')
    let lastScrollY = 0

    window.addEventListener('scroll', () => {
      const currentScroll = window.scrollY

      // Mobile: nu aplica shrink dacă lățimea e sub md (768px)
      if (!wrapper || window.innerWidth < 768) return

      if (currentScroll > 40 && lastScrollY <= 40) {
        wrapper.classList.add('shrink-horizontal')
      } else if (currentScroll <= 40 && lastScrollY > 40) {
        wrapper.classList.remove('shrink-horizontal')
      }

      lastScrollY = currentScroll
    })
  }
</script>

  <style>
    /* Enhanced site title typography */
    .site-title {
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: hsl(var(--foreground));
      transition: all 0.3s ease;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    /* Responsive sizing */
    @media (min-width: 640px) {
      .site-title {
        font-size: 1.5rem;
      }
    }

    /* Efect de "strângere" orizontală */
    #header-wrapper.shrink-horizontal {
      max-width: 40rem;
      transform: scaleX(0.96);
    }

    #header-wrapper.shrink-horizontal #header-inner {
      padding-left: 1rem;
      padding-right: 1rem;
      opacity: 0.96;
    }

    #header-wrapper.shrink-horizontal img {
      transform: scale(0.92);
    }

    #header-wrapper.shrink-horizontal nav {
      gap: 1.25rem !important;
    }

    /* Adjust title when shrunk */
    #header-wrapper.shrink-horizontal .site-title {
      font-size: 1.25rem;
    }

    /* Enhanced glassmorphism effects */
    #header-inner {
      position: relative;
      background: rgba(var(--background-rgb, 255, 255, 255), 0.6);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(var(--border-rgb, 0, 0, 0), 0.1);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.1),
        0 4px 16px rgba(0, 0, 0, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme='dark'] #header-inner {
      background: rgba(var(--background-rgb, 17, 17, 17), 0.7);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        0 4px 16px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    #header-inner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        rgba(var(--primary-rgb, 0, 0, 0), 0.05) 0%,
        transparent 50%,
        rgba(var(--accent-rgb, 0, 0, 0), 0.03) 100%
      );
      border-radius: inherit;
      pointer-events: none;
      z-index: -1;
    }

    /* Liquid animation */
    @keyframes spin-slow {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    .animate-spin-slow {
      animation: spin-slow 20s linear infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px) scale(1);
      }
      50% {
        transform: translateY(-2px) scale(1.01);
      }
    }

    @keyframes shimmer {
      0% {
        opacity: 0.3;
      }
      50% {
        opacity: 0.6;
      }
      100% {
        opacity: 0.3;
      }
    }

    #header-inner {
      animation: float 6s ease-in-out infinite;
    }

    #header-inner::before {
      animation: shimmer 4s ease-in-out infinite;
    }

    /* Hover effects for liquid feel */
    #header-inner:hover {
      background: rgba(var(--background-rgb, 255, 255, 255), 0.7);
      box-shadow: 
        0 12px 48px rgba(0, 0, 0, 0.15),
        0 8px 24px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    [data-theme='dark'] #header-inner:hover {
      background: rgba(var(--background-rgb, 17, 17, 17), 0.8);
      box-shadow: 
        0 12px 48px rgba(0, 0, 0, 0.4),
        0 8px 24px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }

    /* Enhanced border with gradient */
    #header-inner {
      border: 1px solid rgba(var(--border-rgb, 0, 0, 0), 0.2);
      position: relative;
    }

    #header-inner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(
        135deg,
        rgba(var(--border-rgb, 0, 0, 0), 0.1) 0%,
        rgba(var(--border-rgb, 0, 0, 0), 0.3) 50%,
        rgba(var(--border-rgb, 0, 0, 0), 0.1) 100%
      );
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: exclude;
      pointer-events: none;
    }

    /* Subtle glow effect */
    #header-inner::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(
        45deg,
        rgba(var(--primary-rgb, 0, 0, 0), 0.1),
        rgba(var(--accent-rgb, 0, 0, 0), 0.1),
        rgba(var(--primary-rgb, 0, 0, 0), 0.1)
      );
      border-radius: inherit;
      z-index: -2;
      filter: blur(8px);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #header-inner:hover::after {
      opacity: 1;
    }
  </style>
</header>