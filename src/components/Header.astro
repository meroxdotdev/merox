---
import Link from '@/components/Link.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import { NAV_LINKS } from '@/consts'
import { Image } from 'astro:assets'
import { Icon } from 'astro-icon/components'
import logo from '../../public/static/logo.svg'
import logod from '../../public/static/logod.svg'
---

  <header
    class="sticky top-0 z-50 w-full transition-all duration-300"
    transition:persist
    id="main-header"
  >
  <div
    id="header-wrapper"
    class="mx-auto w-full max-w-3xl transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] px-4 pt-4"
  >
    <div
      id="header-inner"
      class="relative overflow-hidden flex items-center justify-between border-b border-border/50 bg-background/80 backdrop-blur-sm px-4 py-3 xl:rounded-xl xl:border xl:border-primary/20 xl:bg-gradient-to-br xl:from-primary/5 xl:via-primary/3 xl:to-transparent xl:px-8 xl:py-4 xl:backdrop-blur-sm xl:transition-all xl:duration-500 xl:ease-[cubic-bezier(0.4,0,0.2,1)]"
    >
      <!-- Logo -->
      <Link
        href="/"
        class="relative z-10 group flex items-center gap-2.5 transition-opacity duration-200 hover:opacity-80"
        aria-label="Home"
      >
        <div class="relative flex-shrink-0 transition-transform duration-300 group-hover:scale-105">
            <Image
            src={logo}
            alt="Logo"
            class="hidden size-7 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] dark:block xl:size-8"
            width={32}
            height={32}
          />
          <Image
            src={logod}
            alt="Logo"
            class="block size-7 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] dark:hidden xl:size-8"
            width={32}
            height={32}
          />
        </div>
      </Link>

      <!-- Navigation & Actions -->
      <div class="relative z-10 flex items-center gap-1.5 xl:gap-2">
        <!-- Desktop Navigation (only on extra large screens) -->
        <nav class="hidden xl:flex items-center gap-1" aria-label="Main navigation">
          {NAV_LINKS.map((item) => {
            const isExternal = item.href.startsWith('http')
            return (
              <Link
                href={item.href}
                class="nav-link relative px-4 py-2 text-sm font-medium text-foreground/70 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] rounded-lg hover:text-foreground flex items-center gap-1.5"
              >
                <span class="relative z-10">{item.label}</span>
                {isExternal && (
                  <Icon name="lucide:external-link" class="relative z-10 size-3 opacity-60 flex-shrink-0" aria-hidden="true" />
                )}
                <span class="nav-link-underline absolute bottom-1.5 left-4 right-4 h-[1.5px] bg-foreground/20 scale-x-0 origin-center transition-transform duration-200 rounded-full" aria-hidden="true"></span>
              </Link>
            )
          })}
        </nav>

        <!-- Mobile Menu + Theme Toggle -->
        <div class="flex items-center gap-1.5">
          <MobileMenu client:load transition:persist />
          <ThemeToggle transition:persist />
        </div>
      </div>
    </div>
  </div>

  <!-- Header Scroll Controller -->
  <script>
    import { initHeaderScrollController } from '@/scripts/header-scroll-controller'
    
    if (typeof window !== 'undefined') {
      initHeaderScrollController({
        scrollThreshold: 32,
        desktopBreakpoint: 1280,
        headerIds: {
          wrapper: 'header-wrapper',
          inner: 'header-inner',
        },
      })
    }
  </script>

  <style>
    /* Mobile & Tablet: Clean minimal style */
    @media (max-width: 1279px) {
      #header-inner {
        border-radius: 0;
        box-shadow: none;
        background: hsl(var(--background) / 0.85);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid hsl(var(--border) / 0.5);
        border-top: none;
        border-left: none;
        border-right: none;
        padding: 0.875rem 1rem;
      }

      .dark #header-inner {
        background: hsl(var(--background) / 0.85);
      }
    }

    /* Desktop: Modern design matching site */
    @media (min-width: 1280px) {
      .nav-link:hover .nav-link-underline {
        transform: scaleX(1);
      }

      .nav-link:focus-visible {
        outline: 2px solid hsl(var(--primary));
        outline-offset: 2px;
        border-radius: 0.5rem;
      }

      /* Scroll shrink effect - Modern 2025 approach: Height reduction only */
      /* Maintains width consistency with content (max-w-3xl) */
      #header-wrapper.shrink {
        padding-top: 0.75rem;
      }

      #header-wrapper.shrink #header-inner {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        /* Enhanced glassmorphism on scroll for better visibility */
        background: hsl(var(--background) / 0.95);
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 6px -1px hsl(var(--foreground) / 0.05),
                    0 2px 4px -1px hsl(var(--foreground) / 0.03);
      }

      .dark #header-wrapper.shrink #header-inner {
        background: hsl(var(--background) / 0.95);
        box-shadow: 0 4px 6px -1px hsl(var(--foreground) / 0.1),
                    0 2px 4px -1px hsl(var(--foreground) / 0.05);
      }

      /* Respect user motion preferences */
      @media (prefers-reduced-motion: reduce) {
        #header-wrapper,
        #header-inner {
          transition: none !important;
        }
      }
    }
  </style>
</header>