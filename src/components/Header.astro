---
import Link from '@/components/Link.astro';
import ThemeToggle from '@/components/ThemeToggle.astro';
import MobileMenu from '@/components/ui/mobile-menu';
import { NAV_LINKS } from '@/consts';
import { Image } from 'astro:assets';
import logo from '../../public/static/logo.svg';
import logod from '../../public/static/logod.svg';
---

<header id="main-header" class="sticky top-0 z-50">
  <div id="header-wrapper" class="mx-auto max-w-4xl transition-all duration-500">
    <div
      id="header-inner"
      class="flex items-center justify-between gap-4 px-4 py-3 bg-background/70 border-b border-border/40 shadow-sm backdrop-blur-xl rounded-3xl md:px-8 md:py-4 md:shadow-lg md:shadow-black/[0.04] md:hover:shadow-xl md:hover:shadow-black/[0.08] transition-all duration-300 ease-out"
    >
      <!-- Logo -->
      <Link href="/" class="flex items-center gap-3.5 transition-opacity duration-300 hover:opacity-90">
        <Image src={logo} alt="Logo" class="hidden dark:block h-9 w-9 md:h-10 md:w-10" />
        <Image src={logod} alt="Logo" class="block dark:hidden h-9 w-9 md:h-10 md:w-10" />
      </Link>

      <!-- Right side: Nav + Theme + Mobile -->
      <div class="flex items-center gap-2 ml-auto">
        <!-- Desktop Nav -->
        <nav class="hidden md:flex items-center gap-1">
          {NAV_LINKS.map((item, index) => (
            <Link
              href={item.href}
              class="relative px-4 py-2.5 text-sm font-medium text-foreground/70 hover:text-foreground transition-colors duration-300 rounded-2xl overflow-hidden group"
              style={`transition-delay: ${index * 50}ms;`}
            >
              <span class="relative z-10">{item.label}</span>
              <div class="absolute inset-0 bg-foreground/5 scale-x-0 group-hover:scale-x-100 origin-left transition-transform duration-300 ease-out rounded-2xl"></div>
            </Link>
          ))}
        </nav>

        <!-- Mobile + Theme -->
        <MobileMenu client:load />
        <ThemeToggle class="hidden md:block" />
      </div>
    </div>
  </div>

  <script>
    if (typeof window !== 'undefined') {
      const header = document.getElementById('header-inner');
      const wrapper = document.getElementById('header-wrapper');
      let ticking = false;

      const handleScroll = () => {
        const currentScroll = window.scrollY;
        const shrinkThreshold = 48;
        const shouldShrink = currentScroll > shrinkThreshold;

        header.classList.toggle('shrink', shouldShrink);
        wrapper.classList.toggle('shrink', shouldShrink);

        ticking = false;
      };

      const onScroll = () => {
        if (!ticking) {
          requestAnimationFrame(handleScroll);
          ticking = true;
        }
      };

      window.addEventListener('scroll', onScroll);
      window.addEventListener('resize', handleScroll);
    }
  </script>

  <style>
    /* Desktop spacing */
    @media (min-width: 768px) {
      #main-header {
        padding-top: 1rem; /* spa»õiu deasupra */
      }
    }

    /* Mobile preserved */
    @media (max-width: 767px) {
      #header-inner {
        border-radius: 0 !important;
        box-shadow: none !important;
        background: hsl(var(--background)/0.7) !important;
        border-bottom: 1px solid hsl(var(--border)/0.4) !important;
        padding: 0.75rem 1rem !important;
      }
    }



    /* Shrink effect */
    #header-wrapper.shrink {
      max-width: 42rem;
      transform: translateY(-4px) scale(0.97);
      transition: all 0.3s ease;
    }
    #header-wrapper.shrink #header-inner {
      padding: 0.875rem 1.5rem;
      border-radius: 2.5rem;
    }
    #header-wrapper.shrink img { transform: scale(0.89); }

    /* Glass effect */
    #header-inner {
      position: relative;
      background: hsl(var(--background)/0.7);
      backdrop-filter: blur(16px);
      transition: all 0.3s ease;
    }
    #header-inner::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(135deg, hsl(var(--border)/0.3) 0%, transparent 50%, hsl(var(--border)/0.2) 100%);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    #header-inner:hover::before { opacity: 1; }

    nav a:focus-visible {
      outline: 2px solid hsl(var(--primary));
      outline-offset: 2px;
      border-radius: 1.5rem;
    }
  </style>
</header>