---
import Link from '@/components/Link.astro'
import { Icon } from 'astro-icon/components'

interface Props {
  jobTitle: string
  worksFor: string
  /** Lottie JSON URL for light theme (original colors). */
  lottieSrcLight: string
  /** Lottie JSON URL for dark theme (inverted colors). */
  lottieSrcDark: string
}

const { jobTitle, worksFor, lottieSrcLight, lottieSrcDark } = Astro.props
---

<div class="bento-card bento-identity">
  <div class="bento-identity__content">
    <p class="identity-role panel-title" aria-label={`${jobTitle} at ${worksFor}`}>
      <span class="identity-role__dot" aria-hidden="true"></span>
      {jobTitle}<span class="identity-role__sep" aria-hidden="true">/</span>{worksFor}
    </p>
    <h1 class="text-3xl sm:text-4xl md:text-5xl font-black tracking-tighter uppercase leading-[0.92] break-words">
      Building<br />infrastructure<br /><span class="text-primary transition-colors duration-300">that scales</span>.
    </h1>
    <p class="mt-4 text-sm md:text-[15px] text-muted-foreground/75 max-w-md leading-relaxed">
      Technical blog on infrastructure, homelab, and automation â€” and the person behind it. For people who run systems.
    </p>
    <div class="flex flex-wrap items-center gap-4 mt-6">
      <Link href="/blog" class="btn-neo-primary" aria-label="Read the blog">
        Read the blog
        <Icon name="lucide:arrow-right" class="btn-neo-icon" aria-hidden="true" />
      </Link>
      <Link href="/about" class="btn-neo-outline" aria-label="About me">
        <Icon name="lucide:user" class="btn-neo-icon" aria-hidden="true" />
        About me
      </Link>
    </div>
  </div>
  <!--
    Hero Lottie: theme-aware. Two layers (light + dark) both loaded once.
    Visibility = CSS only (instant). Only the visible instance runs (pause/play on theme-change).
  -->
  <div class="bento-identity__image overflow-hidden relative">
    <div class="hero-img-inner relative w-full h-full">
      <div class="hero-img-frame hero-lottie-wrap relative" aria-label="Robert Melcher in datacenter">
        <div
          class="hero-lottie-layer hero-lottie-light absolute inset-0"
          id="hero-lottie-light"
          data-lottie-src={lottieSrcLight}
          aria-hidden="true"
        />
        <div
          class="hero-lottie-layer hero-lottie-dark absolute inset-0"
          id="hero-lottie-dark"
          data-lottie-src={lottieSrcDark}
          aria-hidden="true"
        />
      </div>
    </div>
  </div>
</div>

<style>
  .hero-lottie-light {
    display: block;
  }
  .hero-lottie-dark {
    display: none;
  }
  :global(html[data-theme="dark"]) .hero-lottie-light {
    display: none;
  }
  :global(html[data-theme="dark"]) .hero-lottie-dark {
    display: block;
  }
</style>

<script>
  import lottie from 'lottie-web'

  const LOTTIE_OPTS = {
    renderer: 'svg',
    loop: true,
    autoplay: true,
    initialSegment: [1, 90],
  } as const

  const elLight = document.getElementById('hero-lottie-light')
  const elDark = document.getElementById('hero-lottie-dark')
  const srcLight = elLight?.getAttribute('data-lottie-src')
  const srcDark = elDark?.getAttribute('data-lottie-src')

  if (elLight && srcLight && elDark && srcDark) {
    const animLight = lottie.loadAnimation({ container: elLight, path: srcLight, ...LOTTIE_OPTS })
    const animDark = lottie.loadAnimation({ container: elDark, path: srcDark, ...LOTTIE_OPTS })
    animLight.setSpeed(1)
    animDark.setSpeed(1)

    function syncPlaybackToTheme() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
      if (isDark) {
        animLight.pause()
        animDark.play()
      } else {
        animLight.play()
        animDark.pause()
      }
    }

    syncPlaybackToTheme()
    window.addEventListener('theme-change', syncPlaybackToTheme)
  }
</script>
