---
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import Layout from '@/layouts/Layout.astro'
import { Icon } from 'astro-icon/components'
import { getRecentPosts } from '@/lib/data-utils'
import { Image } from 'astro:assets'
import { formatDate } from '@/lib/utils'

const latestPosts = await getRecentPosts(2)

const highlights = [
  'Full datacenter deployments with InfiniBand clusters at Forvia',
  'Homelab Kubernetes cluster with Talos Linux, Flux GitOps, and Cilium CNI',
  'Proxmox virtualization with automated deployments on Dell R720',
  'pfSense firewall with VLAN segmentation and WAF security',
  'AWS/EC2 applications and Oracle Ampere ARM testing',
  'Infrastructure automation with cert-manager, external-dns, and SOPS secrets',
]
---

<Layout class="max-w-3xl">
  <PageHead slot="head" title="Home" />

  <!-- Hero -->
  <section class="rounded-xl border bg-gradient-to-br from-primary/5 via-primary/3 to-transparent">
    <div class="p-8 md:p-10">
      <div class="flex flex-col-reverse gap-6 sm:flex-row sm:items-start sm:justify-between">
        <div class="flex-1 min-w-0">
          <div class="inline-block mb-3">
            <span class="text-xs font-medium uppercase tracking-wider text-primary px-3 py-1 rounded-full bg-primary/10 border border-primary/20">
              HPC System Administrator
            </span>
          </div>
          <h1 class="text-4xl md:text-5xl leading-tight font-bold tracking-tight">
            Building infrastructure<br/>that scales.
          </h1>
          <p class="text-muted-foreground mt-4 leading-relaxed text-base md:text-lg">
            DevOps-focused HPC System Administrator with 9+ years in IT, including 2 years as a Cybersecurity Engineer.
          </p>
          <div class="mt-6 flex flex-wrap items-center gap-3">
            <Link href="/blog" class={buttonVariants({ variant: 'default', size: 'lg' })}>
              Read the blog
            </Link>
            <Link href="/about" class={buttonVariants({ variant: 'outline', size: 'lg' })}>
              About me
            </Link>
          </div>
        </div>
        <img
          src="https://merox.dev/reworkedmeroxdc1.webp"
          alt="Robert Melcher"
          class="w-28 h-28 rounded-full object-cover border-4 border-background shadow-xl flex-shrink-0 ring-2 ring-primary/10"
        />
      </div>
    </div>
  </section>

<!-- Latest from the blog (2 posts) -->
{
  latestPosts && latestPosts.length > 0 && (
    <section class="mt-8">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-2xl font-semibold">Latest from the blog</h2>
        <div class="hidden sm:block">
          <Link href="/blog" class={buttonVariants({ variant: 'ghost' }) + ' group'}>
            See all
            <span class="ml-1.5 transition-transform group-hover:translate-x-1">→</span>
          </Link>
        </div>
      </div>
      <div class="grid gap-4 md:grid-cols-2">
        {latestPosts.map((post) => (
          <Link
            href={`/${post.collection}/${post.id}`}
            class="group relative overflow-hidden rounded-xl border bg-card shadow-sm transition-all hover:shadow-md"
          >
            {
              post.data.image && (
                <div class="relative">
                  <Image
                    src={post.data.image}
                    alt={post.data.title}
                    width={1200}
                    height={630}
                    class="h-40 w-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
                  />
                </div>
              )
            }
            <div class="p-4">
              <h3 class="text-lg font-medium line-clamp-2 group-hover:text-primary transition-colors">
                {post.data.title}
              </h3>
              {
                post.data.description && (
                  <p class="text-sm text-muted-foreground mt-1.5 line-clamp-3">
                    {post.data.description}
                  </p>
                )
              }
              <div class="text-xs text-muted-foreground mt-3 flex items-center gap-2">
                <Icon name="lucide:calendar" class="size-3" />
                <span>{formatDate(post.data.date)}</span>
              </div>
            </div>
          </Link>
        ))}
      </div>
      <div class="mt-4 flex justify-center sm:hidden">
        <Link
          href="/blog"
          class={buttonVariants({ variant: 'ghost' }) + ' group w-full justify-center max-w-xs'}
        >
          See all
          <span class="ml-1.5 transition-transform group-hover:translate-x-1">→</span>
        </Link>
      </div>
    </section>
  )
}

  <!-- Highlights -->
  <section class="mt-8 rounded-xl border">
    <div class="p-6">
      <h2 class="text-2xl font-semibold mb-4">Highlights</h2>
      <div class="space-y-3">
        {highlights.map((highlight) => (
          <div class="flex items-start gap-3 text-sm">
            <span class="text-primary mt-0.5 flex-shrink-0">▸</span>
            <p class="text-muted-foreground leading-relaxed">{highlight}</p>
          </div>
        ))}
      </div>
      <div class="mt-6 pt-6 border-t">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <div>
            <p class="font-semibold">Currently @ Forvia</p>
            <p class="text-sm text-muted-foreground mt-0.5">
              Previously: Atos (Cybersecurity)
            </p>
          </div>
          <Link href="/about" class={buttonVariants({ variant: 'outline' }) + ' flex-shrink-0'}>
            Full background
          </Link>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="mt-8 rounded-xl border border-primary/20 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent">
    <div class="p-8 text-center">
      <h2 class="text-2xl font-semibold mb-3">
        Interested in HPC, Kubernetes, or homelab automation?
      </h2>
      <p class="text-muted-foreground mb-6 max-w-xl mx-auto">
        Providing expertise and custom solutions in infrastructure automation, security hardening, and scalable deployments.
      </p>
      <Link href="mailto:hello@merox.dev" class={buttonVariants({ variant: 'default', size: 'lg' }) + ' group gap-2'}>
        <Icon name="lucide:mail" class="size-4" />
        Get in contact
        <span class="ml-1 transition-transform group-hover:translate-x-1">→</span>
      </Link>
    </div>
  </section>
</Layout>